"use strict";console.log("user loaded");var PM=function(a){var b="https://sleepy-sands-2399.herokuapp.com/",c=localStorage.getItem("authToken"),d={users:b+"users/",projects:b+"projects/",tasks:b+"tasks/",comments:b+"comments/",fileLocations:b+"file_locations/"};return a.runLogin=function(){$("#loginForm").on("submit",a.submitLogin),$("#registrationForm").on("submit",a.parseRails),$("#sign-out").on("click",a.signOut)},a.submitRegistration=function(b){$.ajax({url:d.users,type:"POST",data:b}).done(function(b){a.loginSuccess(b)}).fail(function(a){console.log(a)})},a.hasProfPic=function(b){var c,d=b;""!==$("#file_upload").val()?(c={user:{email:$("#email-reg").val(),user_name:$("#user-name").val(),first_name:$("#first-name").val(),last_name:$("#last-name").val(),password:$("#password-reg").val(),image_url:"https://s3.amazonaws.com/team-fielding/"+d}},a.deferred.done(function(){a.submitRegistration(c)})):(c={user:{email:$("#email-reg").val(),user_name:$("#user-name").val(),first_name:$("#first-name").val(),last_name:$("#last-name").val(),password:$("#password-reg").val()}},a.submitRegistration(c))},a.submitLogin=function(b){var c;return b.preventDefault(),c=$(this),$.ajax({url:d.users+"sign_in",type:"POST",data:c.serialize()}).done(a.loginSuccess).fail(a.acceptFailure),!1},a.loginSuccess=function(a){localStorage.setItem("authToken",a.token),localStorage.setItem("currentUser",a.id),console.log("logged in!"),window.location.href="/#/home"},a.acceptFailure=function(a){401===a.status&&(console.log("SEND TO landing SCREEN"),window.location.href="/landing.html")},a.renderUser=function(){var b=localStorage.getItem("currentUser");$.ajax({url:d.users+b,type:"GET",headers:{AUTHORIZATION:"Token token="+c}}).done(function(b){var c=Handlebars.templates.homeTemplate;Handlebars.partials=Handlebars.templates,$("#sidebar").html(c({user:b})),a.populateUpdateForm(b)}).fail(function(b){a.acceptFailure(b)})},a.userUpdateData=function(b){var c=$("#file_upload"),d=$("#password-reg"),e={user:{email:$("#email-reg").val(),user_name:$("#user-name").val(),first_name:$("#first-name").val(),last_name:$("#last-name").val()}};""!==c.val()&&""!==d.val()?(e.user.password=$("#password-reg").val(),e.user.image_url="https://s3.amazonaws.com/team-fielding/"+b,a.deferred.done(function(){a.updateUser(e)})):""!==c.val()&&""===d.val()?(e.user.image_url="https://s3.amazonaws.com/team-fielding/"+b,a.deferred.done(function(){a.updateUser(e)})):""===c.val()&&""!==d.val()?(e.user.password=$("#password-reg").val(),a.updateUser(e)):a.updateUser(e)},a.updateUser=function(a){var b=localStorage.getItem("currentUser");$.ajax({url:d.users+b,type:"PATCH",beforeSend:function(a){a.setRequestHeader("AUTHORIZATION","Token token="+c)},data:a}).done(function(){window.location.href="/"}).fail(function(){console.log("failure")})},a.populateUpdateForm=function(a){$("#email-reg").val(a.email),$("#user-name").val(a.user_name),$("#first-name").val(a.first_name),$("#last-name").val(a.last_name)},a.showUpdateForm=function(a){a.preventDefault(),$(".form.update").toggle()},a.signOut=function(a){a.preventDefault(),localStorage.clear(),window.location.href="/"},a}(PM||{});$(document).ready(function(){PM.runLogin()}),console.log("project loaded");var PM=function(a){var b="https://sleepy-sands-2399.herokuapp.com/",c=localStorage.getItem("authToken"),d=localStorage.getItem("currentUser"),e={users:b+"users/",projects:b+"projects/",tasks:b+"tasks/",comments:b+"comments/",fileLocations:b+"file_locations/"};return a.getProjects=function(){$.ajax({url:e.users+d+"/projects",headers:{AUTHORIZATION:"Token token="+c}}).done(function(a){console.log(a)}).fail(function(a,b,c){console.log(a,b,c)})},a.getProject=function(b){$.ajax({url:e.projects+b,headers:{AUTHORIZATION:"Token token="+c}}).done(function(b){var c=a.getSupertasks(b);Handlebars.partials=Handlebars.templates;var d=Handlebars.templates.projectshowTemplate;localStorage.setItem("projectId",b.id),$("#content-top").html(d({project:b,tasks:c}))}).fail(function(a,b,c){console.log(a,b,c)})},a.getSupertasks=function(a){for(var b=[],c=0;c<a.tasks.length;c++)null===a.tasks[c].supertask_id&&b.push(a.tasks[c]);return b},a.submitProject=function(b){b.preventDefault(),$.ajax({url:e.users+d+"/projects",type:"post",dataType:"json",headers:{AUTHORIZATION:"Token token="+c},data:{project:{project_title:$("#projectTitle").val(),description:$("#description").val(),start_date:$("#startDate").val(),due_date:$("#dueDate").val(),completion_date:$("#completionDate").val(),completed:$("#completed").is(":checked"),visible:$("#visible").is(":checked")}}}).done(function(){a.renderUser()}).fail(function(){console.log("error")})},a.showForm=function(){$(".projectForm").toggle()},a}(PM||{});console.log("task loaded");var PM=function(a){var b="https://sleepy-sands-2399.herokuapp.com/",c=localStorage.getItem("authToken"),d=localStorage.getItem("projectId"),e=localStorage.getItem("taskId");return a.apiRoutes={users:b+"users/",projects:b+"projects/",tasks:b+"tasks/",comments:b+"comments/",fileLocations:b+"file_locations/"},a.getTasks=function(b){$.ajax({url:a.apiRoutes.projects+b+"/tasks",type:"GET",headers:{AUTHORIZATION:"Token token="+c}}).done(function(a){console.log(a)}).fail(function(a,b,c){console.log(a,b,c)})},a.getOneTask=function(b){$.ajax({url:a.apiRoutes.tasks+b,type:"GET",headers:{AUTHORIZATION:"Token token="+c}}).done(function(b){var c=a.getSupercomments(b);localStorage.setItem("taskId",b.id),Handlebars.partials=Handlebars.templates;var d=Handlebars.templates.taskShowTemplate;$("#column-right").html(d({task:b,comments:c}))}).fail(function(a,b,c){console.log(a,b,c)})},a.getSupercomments=function(a){for(var b=[],c=0;c<a.comments.length;c++)null===a.comments[c].supercomment_id&&b.push(a.comments[c]);return b},a.createTask=function(b){d=localStorage.getItem("projectId"),b.preventDefault(),$.ajax({url:a.apiRoutes.projects+d+"/tasks",type:"POST",headers:{AUTHORIZATION:"Token token="+c},data:{task:{due_date:$(".new-task-form .taskDueDate").val(),completed:$(".new-task-form .taskCompleted").is(":checked"),priority:$(".new-task-form .taskPriority").val(),title:$(".new-task-form .taskTitle").val(),description:$(".new-task-form .taskDescription").val()}}}).done(function(){window.location.href="/#/projects/"+d}).fail(function(a,b,c){console.log(a,b,c)})},a.patchTask=function(b,d){b.preventDefault(),$.ajax({url:a.apiRoutes.tasks+d,type:"PATCH",headers:{AUTHORIZATION:"Token token="+c},data:{task:{due_date:$("input#taskDueDate").val(),completed:$("input#taskCompleted").is(":checked"),priority:$("select#taskPriority").val(),title:$("input#taskTitle").val(),description:$("textarea#taskDescription").val()}}}).done(function(a){console.log(a)}).fail(function(a,b,c){console.log(a,b,c)})},a.deleteTask=function(b,d){b.preventDefault(),$.ajax({url:a.apiRoutes.tasks+d,type:"DELETE",headers:{AUTHORIZATION:"Token token="+c}}).done(function(a){console.log(a),location.reload()}).fail(function(a,b,c){console.log(a,b,c)})},a.createSubtask=function(b){b.preventDefault(),e=localStorage.getItem("taskId"),$.ajax({url:a.apiRoutes.tasks+e+"/subtasks",type:"POST",headers:{AUTHORIZATION:"Token token="+c},data:{task:{due_date:$(".new-subtask-form .taskDueDate").val(),completed:$(".new-subtask-form .taskCompleted").is(":checked"),priority:$(".new-subtask-form .taskPriority").val(),title:$(".new-subtask-form .taskTitle").val(),description:$(".new-subtask-form .taskDescription").val()}}}).done(function(){window.location.href="/#/tasks/"+e}).fail(function(a){console.log(a)})},a.showTaskForm=function(){$(".new-task-form").toggle()},a.showSubtaskForm=function(){$(".new-subtask-form").toggle()},$(".newTaskForm").on("submit",a.createTask),a}(PM||{});$(document).ready(function(){}),console.log("comment loaded");var PM=function(a){var b="https://sleepy-sands-2399.herokuapp.com/",c=localStorage.getItem("authToken"),d=localStorage.getItem("taskId");return a.apiRoutes={users:b+"users/",projects:b+"projects/",tasks:b+"tasks/",comments:b+"comments/",fileLocations:b+"file_locations/"},a.getComment=function(b){$.ajax({url:a.apiRoutes.comments+b,headers:{AUTHORIZATION:"Token token="+c}}).done(function(a){var b=Handlebars.templates.commentShowTemplate;$("#column-left").html(b({comment:a}))}).fail(function(){console.log("error")})},a.getComments=function(b){$.ajax({url:a.apiRoutes.tasks+b+"/comments",type:"get",dataType:"json",headers:{AUTHORIZATION:"Token token="+c}}).done(function(a){console.table(a)}).fail(function(a,b,c){console.log(a,b,c)})},a.createComment=function(b){b.preventDefault(),$.ajax({url:a.apiRoutes.tasks+d+"/comments",type:"POST",headers:{AUTHORIZATION:"Token token="+c},data:{comment:{body:$("#commentBody").val()}}}).done(function(){window.location.href="/#/tasks/"+d}).fail(function(){console.log("error")})},a}(PM||{});console.log("upload.js loaded");var PM=function(a){var b="https://sleepy-sands-2399.herokuapp.com/",c=localStorage.getItem("currentUser"),d=localStorage.getItem("authToken");a.deferred=$.Deferred();var e={users:b+"users/",projects:b+"projects/",tasks:b+"tasks/",comments:b+"comments/",fileLocations:b+"file_locations/",amazon:b+"amazon/sign_key/image%2Fjpeg"};return a.parseRails=function(b){b.preventDefault(),$.get(e.amazon,function(c){"user-update-form"===b.target.id?a.userUpdateData(c.key):a.hasProfPic(c.key),a.unpackRails(c)})},a.unpackRails=function(b){var c=new FormData,d=$("#file_upload")[0],e=d.files[0];e&&(c.append("key",b.key),c.append("AWSAccessKeyId",b.access_key),c.append("policy",b.policy),c.append("signature",b.signature),c.append("Content-Type",e.type),c.append("file",e),a.awsRequest(c))},a.storeUrl=function(a){$.ajax({url:e.users+c,type:"PATCH",headers:{AUTHORIZATION:"Token token="+d},data:{user:{image_url:"https://s3.amazonaws.com/team-fielding/"+a}}}).done(function(){console.log("success")}).fail(function(){console.log("error")})},a.setAwsHeader=function(){$.ajaxPrefilter(function(a){a.headers={},a.headers.Accept="text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8"})},a.awsRequest=function(b){a.setAwsHeader(),$.ajax({url:"https://s3.amazonaws.com/team-fielding",type:"POST",data:b,processData:!1,contentType:!1}).done(function(){console.log("image sent to amazon"),a.deferred.resolve()}).fail(function(a){console.log(a)})},a}(PM||{});console.log("main loaded");var Router=Backbone.Router.extend({routes:{"":"home",home:"home","projects/:id":"getProject","tasks/:id":"getOneTask","comments/:id":"getComment"},home:PM.renderUser(),getProject:function(a){PM.getProject(a)},getOneTask:function(a){PM.getOneTask(a)},getComment:function(a){PM.getComment(a)}}),setClickHandlers=function(){$("#sidebar").on("click","#new-project-button",PM.showForm),$("#sidebar").on("submit","#newProjectForm",PM.submitProject),$("#content-top").on("click","#new-task-button",PM.showTaskForm),$("#content-top").on("submit",".new-task-form .newTaskForm",PM.createTask),$("#column-right").on("click","#new-subtask-button",PM.showSubtaskForm),$("#column-right").on("submit",".new-subtask-form .newTaskForm",PM.createSubtask),$("#column-right").on("submit",".new-comment-form .newCommentForm",PM.createComment),$("#sidebar").on("click",".update-user-link",PM.showUpdateForm),$("#sidebar").on("submit","#user-update-form",PM.parseRails)};new Router,Backbone.history.start(),$(document).ready(function(){setClickHandlers()}),!function(){var a=Handlebars.template,b=Handlebars.templates=Handlebars.templates||{};b.commentShowTemplate=a({1:function(a,b,c,d){var e,f=b.helperMissing,g="function",h=this.escapeExpression;return'      <li><a href="/#/comments/'+h((e=null!=(e=b.id||(null!=a?a.id:a))?e:f,typeof e===g?e.call(a,{name:"id",hash:{},data:d}):e))+'">'+h((e=null!=(e=b.body||(null!=a?a.body:a))?e:f,typeof e===g?e.call(a,{name:"body",hash:{},data:d}):e))+"</a></li>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f=this.lambda,g=this.escapeExpression;return"<div id='comment'>\n  <h1>"+g(f(null!=(e=null!=a?a.comment:a)?e.body:e,a))+"</h1>\n  <h3>"+g(f(null!=(e=null!=(e=null!=a?a.comment:a)?e.user:e)?e.user_name:e,a))+"</h3>\n  <h6>"+g(f(null!=(e=null!=a?a.comment:a)?e.created_at:e,a))+"</h6>\n  <ul>\n    <h4>Subcomments:</h4>\n"+(null!=(e=b.each.call(a,null!=(e=null!=a?a.comment:a)?e.subcomments:e,{name:"each",hash:{},fn:this.program(1,d,0),inverse:this.noop,data:d}))?e:"")+"  </ul>\n</div>\n"},useData:!0}),b["commentform-partial"]=a({compiler:[6,">= 2.0.0-beta.1"],main:function(){return"<h3>New Comment</h3>\n<form class='newCommentForm'>\n  <fieldset>\n    <textarea id=\"commentBody\" name=\"commentBody\"></textarea>\n  </fieldset>\n  <button type='submit'>Submit</button>\n</form>\n"},useData:!0}),b.homeTemplate=a({1:function(a,b,c,d){var e,f=b.helperMissing,g="function",h=this.escapeExpression;return'      <li><a href="/#/projects/'+h((e=null!=(e=b.id||(null!=a?a.id:a))?e:f,typeof e===g?e.call(a,{name:"id",hash:{},data:d}):e))+'">'+h((e=null!=(e=b.project_title||(null!=a?a.project_title:a))?e:f,typeof e===g?e.call(a,{name:"project_title",hash:{},data:d}):e))+"</a></li>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f=this.lambda,g=this.escapeExpression;return"<div id='user'>\n  <img src="+g(f(null!=(e=null!=a?a.user:a)?e.image_url:e,a))+' alt="Profile Picture"><h1>'+g(f(null!=(e=null!=a?a.user:a)?e.user_name:e,a))+"</h1>\n  <h2>"+g(f(null!=(e=null!=a?a.user:a)?e.first_name:e,a))+" "+g(f(null!=(e=null!=a?a.user:a)?e.last_name:e,a))+'</h2><a href="#" class="update-user-link">update</a>\n  <h3>Projects:</h3>\n  <ul>\n'+(null!=(e=b.each.call(a,null!=(e=null!=a?a.user:a)?e.projects:e,{name:"each",hash:{},fn:this.program(1,d,0),inverse:this.noop,data:d}))?e:"")+'  </ul>\n  <button id="new-project-button" type="">New Project</button>\n'+(null!=(e=this.invokePartial(c["userform-partial"],a,{name:"userform-partial",data:d,indent:"  ",helpers:b,partials:c}))?e:"")+"    <div class=\"projectForm\">\n      <h3>New Project</h3>\n        <form id='newProjectForm'>\n          <fieldset>\n            <label for='projectTitle'>\n              <input type='text' name='projectTitle' id='projectTitle'autofocus='true' />\n              Project Title\n            </label>\n            <br>\n            <label for='description'>\n              <input type='text' name='description' id='description' />\n              Description\n            </label>\n            <br>\n            <label for='startDate'>\n              <input type='date' name='startDate' id='startDate' />\n              Start Date\n            </label>\n            <br>\n            <label for='dueDate'>\n              <input type='date' name='dueDate' id='dueDate' />\n              Due Date\n            </label>\n            <br>\n            <label for='completionDate'>\n              <input type='date' name='completionDate' id='completionDate' />\n              Completion Date\n            </label>\n            <br>\n            <label for='completed'>\n              <!-- <input type='hidden' name='completed' id='completed' value='false'/> -->\n              <input type='checkbox' name='completed' id='completed'/>\n              Completed\n            </label>\n            <br>\n            <label for='visible'>\n              <input type='checkbox' name='visible' id='visible' checked/>\n              Visible\n            </label>\n          </fieldset>\n\n          <button type='submit'>Submit</button>\n        </form>\n    </div>\n</div>\n"},usePartial:!0,useData:!0}),b.projectshowTemplate=a({1:function(a,b,c,d){var e,f=b.helperMissing,g="function",h=this.escapeExpression;return'      <li><a href="/#/tasks/'+h((e=null!=(e=b.id||(null!=a?a.id:a))?e:f,typeof e===g?e.call(a,{name:"id",hash:{},data:d}):e))+'">'+h((e=null!=(e=b.title||(null!=a?a.title:a))?e:f,typeof e===g?e.call(a,{name:"title",hash:{},data:d}):e))+"</a></li>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f=this.lambda,g=this.escapeExpression;return"<div id='project'>\n  <h1>"+g(f(null!=(e=null!=a?a.project:a)?e.project_title:e,a))+"</h1>\n  <h3>"+g(f(null!=(e=null!=a?a.project:a)?e.start_date:e,a))+"</h3>\n  <h5>Tasks:</h5>\n  <ul>\n"+(null!=(e=b.each.call(a,null!=a?a.tasks:a,{name:"each",hash:{},fn:this.program(1,d,0),inverse:this.noop,data:d}))?e:"")+'  </ul>\n  <button id="new-task-button" type="">New Task</button>\n  <div class="new-task-form">\n'+(null!=(e=this.invokePartial(c["taskform-partial"],a,{name:"taskform-partial",data:d,indent:"    ",helpers:b,partials:c}))?e:"")+"  </div>\n</div>\n"},usePartial:!0,useData:!0}),b.taskShowTemplate=a({1:function(a,b,c,d){var e,f=b.helperMissing,g="function",h=this.escapeExpression;return'      <li><a href="/#/tasks/'+h((e=null!=(e=b.id||(null!=a?a.id:a))?e:f,typeof e===g?e.call(a,{name:"id",hash:{},data:d}):e))+'">'+h((e=null!=(e=b.title||(null!=a?a.title:a))?e:f,typeof e===g?e.call(a,{name:"title",hash:{},data:d}):e))+"</a></li>\n"},3:function(a,b,c,d){var e,f=b.helperMissing,g="function",h=this.escapeExpression;return'    <li><a href="/#/comments/'+h((e=null!=(e=b.id||(null!=a?a.id:a))?e:f,typeof e===g?e.call(a,{name:"id",hash:{},data:d}):e))+'">'+h((e=null!=(e=b.body||(null!=a?a.body:a))?e:f,typeof e===g?e.call(a,{name:"body",hash:{},data:d}):e))+"</a></li>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f=this.lambda,g=this.escapeExpression;return"<div id='task'>\n  <h1>"+g(f(null!=(e=null!=a?a.task:a)?e.title:e,a))+"</h1>\n  <h3>"+g(f(null!=(e=null!=a?a.task:a)?e.completed:e,a))+"</h3>\n  <ul>\n    <h4>Subtasks:</h4>\n"+(null!=(e=b.each.call(a,null!=(e=null!=a?a.task:a)?e.subtasks:e,{name:"each",hash:{},fn:this.program(1,d,0),inverse:this.noop,data:d}))?e:"")+"    <button id=\"new-subtask-button\">New Subtask</button>\n    <div class='new-subtask-form'>\n"+(null!=(e=this.invokePartial(c["taskform-partial"],a,{name:"taskform-partial",data:d,indent:"      ",helpers:b,partials:c}))?e:"")+"    </div>\n    <h4>Comments:</h4>\n"+(null!=(e=b.each.call(a,null!=a?a.comments:a,{name:"each",hash:{},fn:this.program(3,d,0),inverse:this.noop,data:d}))?e:"")+"    <div class='new-comment-form'>\n"+(null!=(e=this.invokePartial(c["commentform-partial"],a,{name:"commentform-partial",data:d,indent:"      ",helpers:b,partials:c}))?e:"")+"    </div>\n  </ul>\n</div>\n"},usePartial:!0,useData:!0}),b["taskform-partial"]=a({compiler:[6,">= 2.0.0-beta.1"],main:function(){return"<div class='form new'>\n<h3>New Task</h3>\n    <form class='newTaskForm'>\n      <fieldset>\n        <label for='taskTitle'>\n          <input type='text' name='taskTitle' class='taskTitle'autofocus='true' />\n          Title\n        </label>\n        <br>\n        <label for='taskDescription'>\n          <textarea class='taskDescription'></textarea>\n          Description\n        </label>\n        <br>\n        <label for='taskDueDate'>\n          <input type='date' name='taskDueDate' class='taskDueDate' />\n          Due Date\n        </label>\n        <br>\n        <label for='taskCompleted'>\n          <input type='checkbox' name='taskCompleted' class='taskCompleted' />\n          Completed?\n        </label>\n        <br>\n        <label for='taskPriority'>\n        <select class='taskPriority'>\n          <option value=\"1\">Urgent</option>\n          <option value=\"2\">High</option>\n          <option value=\"3\">Medium</option>\n          <option value=\"4\">Low</option>\n        </select>\n          Priority\n        </label>\n      </fieldset>\n\n    <button type='submit'>Submit</button>\n  </form>\n</div>\n"},useData:!0}),b["userform-partial"]=a({compiler:[6,">= 2.0.0-beta.1"],main:function(){return"<div class='form update'>\n  <form id='user-update-form'>\n    <fieldset>\n      <label for='email'>\n        <input type='text' id='email-reg' name='email' autofocus='true' />\n        E-mail\n      </label>\n      <br>\n      <label for='user_name'>\n        <input type='text' id='user-name' name='user_name' autofocus='true' />\n        User Name\n      </label>\n      <br>\n      <label for='first_name'>\n        <input type='text' id='first-name' name='first_name' autofocus='true' />\n        First Name\n      </label>\n      <br>\n      <label for='last_name'>\n        <input type='text' id='last-name' name='last_name' autofocus='true' />\n        Last Name\n      </label>\n      <br>\n      <label for='password'>\n        <input type='password' id='password-reg' name='password' />\n        Password\n      </label>\n      <br>\n      <label for='file'>\n        <input type='file' name='file' id='file_upload' autofocus='true' />\n        Profile Picture\n      </label>\n    </fieldset>\n\n    <button type='submit'>Save</button>\n  </form>\n</div>\n"},useData:!0})}();